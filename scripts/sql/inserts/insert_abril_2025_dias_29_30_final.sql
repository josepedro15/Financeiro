-- Script para inserir transa√ß√µes de abril 2025 (dias 29, 30) - FECHAMENTO DO M√äS
-- Execute este script no Supabase SQL Editor
-- Insere diretamente na tabela mensal transactions_2025_04
-- NOTA: Lan√ßamentos de META s√£o ignorados conforme instru√ß√£o

-- ==========================================
-- DIA 29 DE ABRIL 2025
-- ==========================================
INSERT INTO public.transactions_2025_04 (user_id, client_name, account_name, transaction_date, description, amount, transaction_type, created_at, updated_at) VALUES
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ROSEANE NOGUEIRA', 'Conta PJ', '2025-04-29', 'ROSEANE NOGUEIRA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'IDALINA ALVES', 'Conta PJ', '2025-04-29', 'IDALINA ALVES', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'VALDIANE CALDEIRA', 'Conta PJ', '2025-04-29', 'VALDIANE CALDEIRA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ISAMARA LIMA', 'Conta PJ', '2025-04-29', 'ISAMARA LIMA', 20.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ANTONIO WANDERLEI', 'Conta PJ', '2025-04-29', 'ANTONIO WANDERLEI', 35.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'GABRIELA KAMINSKI', 'Conta PJ', '2025-04-29', 'GABRIELA KAMINSKI', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'WILMA FERREIRA', 'Conta PJ', '2025-04-29', 'WILMA FERREIRA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'RAFAELA FERNANDES', 'Conta PJ', '2025-04-29', 'RAFAELA FERNANDES', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ELIENE MARGARETE', 'Conta PJ', '2025-04-29', 'ELIENE MARGARETE', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'MARIA APARECIDA', 'Conta PJ', '2025-04-29', 'MARIA APARECIDA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'MARCIO JOSE', 'Conta PJ', '2025-04-29', 'MARCIO JOSE', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'NEIDE SANTANA', 'Conta PJ', '2025-04-29', 'NEIDE SANTANA', 40.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'JACIARA GLECYA', 'Conta PJ', '2025-04-29', 'JACIARA GLECYA', 40.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'MARIA LUCIA', 'Conta PJ', '2025-04-29', 'MARIA LUCIA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'NANY', 'Conta PJ', '2025-04-29', 'NANY', 75.91, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'SUELI ZIMERMANN', 'Conta Checkout', '2025-04-29', 'SUELI ZIMERMANN', 113.81, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'MARIA JANAINA', 'Conta PJ', '2025-04-29', 'MARIA JANAINA', 40.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ANDRESSA RAMOS', 'Conta PJ', '2025-04-29', 'ANDRESSA RAMOS', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'DILENE SANTOS', 'Conta PJ', '2025-04-29', 'DILENE SANTOS', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ROSELANE SALOMAO', 'Conta PJ', '2025-04-29', 'ROSELANE SALOMAO', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'LEILA MARCIA', 'Conta PJ', '2025-04-29', 'LEILA MARCIA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ADEMAR ANTUNES', 'Conta PJ', '2025-04-29', 'ADEMAR ANTUNES', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'VALNEI JOSE', 'Conta PJ', '2025-04-29', 'VALNEI JOSE', 39.95, 'income', NOW(), NOW());

-- ==========================================
-- DIA 30 DE ABRIL 2025 - FECHAMENTO DO M√äS
-- ==========================================
INSERT INTO public.transactions_2025_04 (user_id, client_name, account_name, transaction_date, description, amount, transaction_type, created_at, updated_at) VALUES
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ADRIANA PEREIRA', 'Conta PJ', '2025-04-30', 'ADRIANA PEREIRA', 39.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'FABIANA STEPHANIE', 'Conta PJ', '2025-04-30', 'FABIANA STEPHANIE', 67.92, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'JOS√â ALEX', 'Conta PJ', '2025-04-30', 'JOS√â ALEX', 67.92, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'MELISSA ZOTTI', 'Conta PJ', '2025-04-30', 'MELISSA ZOTTI', 67.92, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'PATRICIA ALVES', 'Conta Checkout', '2025-04-30', 'PATRICIA ALVES', 75.91, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ALESSANDRA ARANDA', 'Conta PJ', '2025-04-30', 'ALESSANDRA ARANDA', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'DANIELA RAMOS', 'Conta PJ', '2025-04-30', 'DANIELA RAMOS', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'THIAGO JOSE', 'Conta PJ', '2025-04-30', 'THIAGO JOSE', 39.95, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'DILENE SANTOS', 'Conta PJ', '2025-04-30', 'DILENE SANTOS', 30.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'FLAVIO JUNIOR', 'Conta PJ', '2025-04-30', 'FLAVIO JUNIOR', 40.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'DEIZIANE DA PENHA', 'Conta PJ', '2025-04-30', 'DEIZIANE DA PENHA', 69.90, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'F SENA DA COSTA', 'Conta PJ', '2025-04-30', 'F SENA DA COSTA', 68.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'VITORIA CANALAN', 'Conta PJ', '2025-04-30', 'VITORIA CANALAN', 35.00, 'income', NOW(), NOW()),
('2dc520e3-5f19-4dfe-838b-1aca7238ae36', 'ADRIELY PEREIRA', 'Conta PJ', '2025-04-30', 'ADRIELY PEREIRA', 40.00, 'income', NOW(), NOW());

-- ==========================================
-- VERIFICA√á√ïES P√ìS-INSER√á√ÉO - FECHAMENTO ABRIL
-- ==========================================

-- 1. Verificar inser√ß√£o por dia (√∫ltimos dias)
SELECT 
    'üìä VERIFICA√á√ÉO DIAS FINAIS:' as status,
    transaction_date,
    COUNT(*) as total_transacoes,
    SUM(amount) as valor_total,
    ROUND(AVG(amount), 2) as valor_medio
FROM public.transactions_2025_04
WHERE transaction_date IN ('2025-04-29', '2025-04-30')
GROUP BY transaction_date
ORDER BY transaction_date;

-- 2. Verificar por conta (dias finais)
SELECT 
    'üí≥ VERIFICA√á√ÉO POR CONTA (DIAS 29-30):' as status,
    account_name,
    COUNT(*) as total_transacoes,
    SUM(amount) as valor_total
FROM public.transactions_2025_04
WHERE transaction_date IN ('2025-04-29', '2025-04-30')
GROUP BY account_name
ORDER BY account_name;

-- 3. Resumo total dos dias finais
SELECT 
    'üéØ RESUMO DIAS 29-30:' as status,
    COUNT(*) as total_transacoes,
    SUM(amount) as valor_total,
    MIN(transaction_date) as primeira_data,
    MAX(transaction_date) as ultima_data
FROM public.transactions_2025_04
WHERE transaction_date IN ('2025-04-29', '2025-04-30');

-- 4. Comparar com valores esperados
SELECT 
    '‚úÖ VALORES ESPERADOS VS INSERIDOS:' as status,
    'Dia 29: R$ 1.003,92 esperado' as dia_29,
    'Dia 30: R$ 721,42 esperado' as dia_30;

-- 5. üèÜ RESUMO COMPLETO DE ABRIL 2025 üèÜ
SELECT 
    'üéâ RESUMO COMPLETO DE ABRIL 2025:' as status,
    COUNT(*) as total_transacoes_mes,
    SUM(amount) as faturamento_total_mes,
    ROUND(AVG(amount), 2) as ticket_medio,
    MIN(transaction_date) as primeiro_dia,
    MAX(transaction_date) as ultimo_dia,
    COUNT(DISTINCT transaction_date) as dias_com_movimento
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4;

-- 6. Top 10 maiores transa√ß√µes de abril
SELECT 
    'üèÜ TOP 10 MAIORES TRANSA√á√ïES DE ABRIL:' as status,
    transaction_date,
    client_name,
    account_name,
    amount,
    ROW_NUMBER() OVER (ORDER BY amount DESC) as ranking
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4
ORDER BY amount DESC
LIMIT 10;

-- 7. Faturamento por dia - vis√£o completa
SELECT 
    'üìÖ FATURAMENTO DI√ÅRIO COMPLETO DE ABRIL:' as status,
    EXTRACT(DAY FROM transaction_date) as dia,
    COUNT(*) as total_transacoes,
    SUM(amount) as valor_total,
    ROUND(AVG(amount), 2) as ticket_medio
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4
GROUP BY EXTRACT(DAY FROM transaction_date)
ORDER BY dia;

-- 8. Resumo por conta
SELECT 
    'üí≥ RESUMO POR CONTA - ABRIL COMPLETO:' as status,
    account_name,
    COUNT(*) as total_transacoes,
    SUM(amount) as valor_total,
    ROUND(AVG(amount), 2) as ticket_medio,
    ROUND((COUNT(*) * 100.0 / (SELECT COUNT(*) FROM public.transactions_2025_04 WHERE EXTRACT(YEAR FROM transaction_date) = 2025 AND EXTRACT(MONTH FROM transaction_date) = 4)), 2) as percentual_transacoes
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4
GROUP BY account_name
ORDER BY valor_total DESC;

-- 9. Verificar dias faltantes (se houver)
SELECT 
    generate_series(1, 30) as dia_faltante
EXCEPT
SELECT 
    EXTRACT(DAY FROM transaction_date)::int
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4
ORDER BY dia_faltante;

-- 10. Estat√≠sticas finais
SELECT 
    'üìà ESTAT√çSTICAS FINAIS DE ABRIL:' as status,
    MIN(amount) as menor_transacao,
    MAX(amount) as maior_transacao,
    ROUND(STDDEV(amount), 2) as desvio_padrao,
    COUNT(DISTINCT client_name) as clientes_unicos,
    ROUND(SUM(amount) / COUNT(DISTINCT transaction_date), 2) as faturamento_medio_diario
FROM public.transactions_2025_04
WHERE EXTRACT(YEAR FROM transaction_date) = 2025 
  AND EXTRACT(MONTH FROM transaction_date) = 4;
