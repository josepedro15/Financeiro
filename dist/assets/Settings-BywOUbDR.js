import{j as e}from"./ui-GI4EfHd4.js";import{r as o}from"./vendor-CZTyH7vC.js";import{u as L,a as T,s as n,X as k,f as r}from"./index-C0zH28-J.js";import{C as b,a as C,b as y,c as E,d as z}from"./card-Z66NZdee.js";import{B as l}from"./button-B4zXH86q.js";import{I as j}from"./input-DQKH0F5o.js";import{L as g}from"./label-BY70Hxrk.js";import{D as R,a as S,T as P,b as I,c as $,d as B,e as H}from"./dialog-BXixbrXY.js";import{A as M,M as O}from"./mail-INlahH7v.js";import{S as V}from"./settings-CLa7pXGH.js";import{S as G}from"./shield-qMZO565s.js";import{U as D}from"./users-DkLvrXhB.js";import{P as K}from"./plus-DjtcETxT.js";import{C as X}from"./check-CliyIdl_.js";import"./supabase-DfbQpoin.js";import"./charts-DE-LwN1H.js";function xe(){const{user:a}=L(),d=T();o.useState(!1);const[c,A]=o.useState([]),[i,f]=o.useState(""),[p,m]=o.useState(!1);o.useEffect(()=>{if(!a){d("/auth");return}x()},[a,d]);const x=async()=>{if(a)try{const{data:s,error:t}=await n.from("organization_members").select("*").eq("owner_id",a.id).order("created_at",{ascending:!1});if(t)return;A(s||[])}catch{}},v=async()=>{if(!a||!i.trim()){r.error("Email é obrigatório");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.trim())){r.error("Formato de email inválido");return}m(!0);try{const{data:t,error:u}=await n.from("organization_members").select("email").eq("owner_id",a.id).eq("email",i.trim().toLowerCase()).single();if(t){r.error("Este email já foi adicionado à organização"),m(!1);return}const{data:N,error:U}=await n.from("profiles").select("id, email").eq("email",i.trim().toLowerCase()).single();let h="pending",w=null;N&&!U&&(h="active",w=N.id);const{data:J,error:F}=await n.from("organization_members").insert({owner_id:a.id,member_id:w,email:i.trim().toLowerCase(),status:h}).select().single();if(F){r.error("Erro ao adicionar usuário");return}r.success(`Usuário ${h==="active"?"adicionado":"convidado"} com sucesso!`),f(""),x()}catch{r.error("Erro ao adicionar usuário")}finally{m(!1)}},_=async(s,t)=>{if(a)try{const{error:u}=await n.from("organization_members").delete().eq("owner_id",a.id).eq("id",s);if(u){r.error("Erro ao remover usuário");return}r.success(`${t} removido da organização`),x()}catch{r.error("Erro ao remover usuário")}},q=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return a?e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>d("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Voltar"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Configurações"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie sua conta e organização"})]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(b,{children:[e.jsxs(C,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Informações da Conta"]}),e.jsx(E,{children:"Suas informações de usuário"})]}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsx(j,{id:"email",value:a.email||"",disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"user-id",children:"ID do Usuário"}),e.jsx(j,{id:"user-id",value:a.id,disabled:!0,className:"bg-muted text-xs"})]})]})})]}),e.jsxs(b,{children:[e.jsxs(C,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Compartilhamento de Dados"]}),e.jsx(E,{children:"Adicione usuários à sua organização para que eles visualizem os mesmos dados"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{htmlFor:"new-user-email",children:"Email do usuário"}),e.jsx(j,{id:"new-user-email",type:"email",placeholder:"usuario@exemplo.com",value:i,onChange:s=>f(s.target.value),onKeyPress:s=>s.key==="Enter"&&v()})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(l,{onClick:v,disabled:p||!i.trim(),className:"flex items-center gap-2",children:p?"Adicionando...":e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),"Adicionar"]})})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Usuários com Acesso (",c.length,")"]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum usuário adicionado ainda"}),e.jsx("p",{className:"text-sm",children:"Adicione o email de um usuário acima"})]}):e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Adicionado em ",q(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:"Ativo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-600",children:"Pendente"})]})}),e.jsxs(R,{children:[e.jsx(S,{asChild:!0,children:e.jsx(l,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(P,{className:"h-4 w-4"})})}),e.jsxs(I,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Remover usuário"}),e.jsxs(H,{children:["Tem certeza que deseja remover ",e.jsx("strong",{children:s.email})," da sua organização? Esta ação não pode ser desfeita."]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(S,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Cancelar"})}),e.jsx(l,{variant:"destructive",onClick:()=>_(s.id,s.email),children:"Remover"})]})]})]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Usuários adicionados terão acesso a todos os seus dados financeiros"}),e.jsx("li",{children:'• Se o usuário já tiver conta, o acesso será imediato (status "Ativo")'}),e.jsx("li",{children:'• Se não tiver conta, aparecerá como "Pendente" até criar uma conta'}),e.jsx("li",{children:"• Você pode remover o acesso a qualquer momento"})]})]})]})]})]})]}):null}export{xe as default};
