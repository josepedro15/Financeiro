import{j as e}from"./ui-GI4EfHd4.js";import{r as p}from"./vendor-CZTyH7vC.js";import{c as $,u as Le,a as Re,s as b}from"./index-DypnXTIk.js";import{C as x,a as h,b as u,d as f,c as F}from"./card-LbNjKmrg.js";import{B as y}from"./button-JwTyC3uk.js";import{S as $e,a as Ie,b as ze,c as qe,d as Ae}from"./select-BTLQ58aw.js";import{D as O}from"./dollar-sign-xKnuQ7w1.js";import{D as Je,A as Be,a as Fe}from"./database-Cgr2X6MW.js";import{U as Oe}from"./users-DqFDTucl.js";import{S as Ue}from"./settings-tKgAaxr7.js";import{C as Ye,T as Ve}from"./trending-up-DxwEpegO.js";import{T as Ke}from"./trending-down-Bq-VHbaa.js";import{R as se,B as We,C as ae,X as ne,Y as re,T as oe,a as Ge,L as Xe,b as He}from"./charts-DE-LwN1H.js";import{P as ce}from"./plus-9BVIZ7p2.js";import"./supabase-DfbQpoin.js";import"./check-D9eZnZVH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=$("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=$("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=$("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2V5z",key:"1ivx2i"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h.01",key:"xkw8gn"}]]);function yt(){const{user:i,signOut:le}=Le(),N=Re(),[I,me]=p.useState([]),[l,U]=p.useState(""),[de,Y]=p.useState(!0),[a,xe]=p.useState({totalIncome:0,totalExpenses:0,balancePJ:0,balanceCheckout:0,recentTransactions:[],monthlyRevenue:[],dailyRevenue:[],currentMonth:"",currentMonthRevenue:0,ticketMedio:0,lucroLiquido:0,margemLucro:0,crescimentoMensal:0,totalTransacoes:0}),[he,ue]=p.useState(!0),[fe,pe]=p.useState(new Date);p.useEffect(()=>{if(!i){N("/auth");return}V()},[i,N]),p.useEffect(()=>{l&&z()},[l]),p.useEffect(()=>{if(!i)return;const t=setInterval(()=>{z()},3e4);return()=>clearInterval(t)},[i]);const V=async()=>{if(i){Y(!0);try{const t=[];t.push({id:i.id,email:i.email||"",name:"Meus dados",isOwner:!0});const{data:v,error:T}=await b.rpc("get_organization_members",{user_member_id:i.id});if(!T&&v&&Array.isArray(v))for(const d of v){const{data:k,error:E}=await b.rpc("get_profile_email",{user_profile_id:d.owner_id});!E&&k&&t.push({id:d.owner_id,email:k,name:`Dados de ${k}`,isOwner:!1})}const{data:w,error:j}=await b.from("organization_members").select(`
          member_id,
          profiles!organization_members_member_id_fkey(email)
        `).eq("owner_id",i.id).eq("status","active");if(!j&&w)for(const d of w)d.profiles&&d.profiles.email&&t.push({id:d.member_id,email:d.profiles.email,name:`Dados compartilhados com ${d.profiles.email}`,isOwner:!0});me(t),t.length>0&&!l&&U(t[0].id)}catch{}finally{Y(!1)}}},z=async()=>{if(!(!i||!l))try{const t=[{table:"transactions_2025_01",month:"Jan",monthNum:1},{table:"transactions_2025_02",month:"Fev",monthNum:2},{table:"transactions_2025_03",month:"Mar",monthNum:3},{table:"transactions_2025_04",month:"Abr",monthNum:4},{table:"transactions_2025_05",month:"Mai",monthNum:5},{table:"transactions_2025_06",month:"Jun",monthNum:6},{table:"transactions_2025_07",month:"Jul",monthNum:7},{table:"transactions_2025_08",month:"Ago",monthNum:8},{table:"transactions_2025_09",month:"Set",monthNum:9},{table:"transactions_2025_10",month:"Out",monthNum:10},{table:"transactions_2025_11",month:"Nov",monthNum:11},{table:"transactions_2025_12",month:"Dez",monthNum:12}];let v=[],T=[],w=[],j=0,d=0,k=0,E=0,K=0,P=0;for(const r of t)try{const{data:_,error:C}=await b.from(r.table).select("*").eq("user_id",l);if(C){w.push({month:r.month,revenue:0});continue}const o=_||[],n=o.filter(s=>s.transaction_type==="income"),g=o.filter(s=>s.transaction_type==="expense"),B=g.filter(s=>s.category!=="Prolabore"),S=n.filter(s=>s.account_name==="Conta PJ"),D=n.filter(s=>s.account_name==="Conta Checkout"),M=g.filter(s=>s.account_name==="Conta PJ"),ke=g.filter(s=>s.account_name==="Conta Checkout"),te=n.reduce((s,c)=>s+Number(c.amount),0),Se=g.reduce((s,c)=>s+Number(c.amount),0),De=B.reduce((s,c)=>s+Number(c.amount),0),Me=S.reduce((s,c)=>s+Number(c.amount),0),Te=D.reduce((s,c)=>s+Number(c.amount),0),Ee=M.reduce((s,c)=>s+Number(c.amount),0),Pe=ke.reduce((s,c)=>s+Number(c.amount),0);j+=te,d+=Se,k+=De,P+=n.length,E+=Me-Ee,K+=Te-Pe,v=[...v,...o],T=[...T,...n],w.push({month:r.month,revenue:te})}catch{w.push({month:r.month,revenue:0})}const{data:je,error:tt}=await b.from("transactions").select("*").eq("user_id",l).order("created_at",{ascending:!1}).limit(5),st=v.filter(r=>r.transaction_date?.startsWith("2025-04")),ge=E,be=K,W=new Date,G=W.getMonth()+1,ye=W.getFullYear(),Ne=t.find(r=>r.monthNum===G)?.month||"",ve=`transactions_${ye}_${String(G).padStart(2,"0")}`;let X=[],H=0;try{const{data:r,error:_}=await b.from(ve).select("transaction_date, amount, account_name").eq("user_id",l).eq("transaction_type","income");if(!_){if(r){const C=new Map;r.forEach(o=>{const n=new Date(o.transaction_date).getDate().toString(),g=C.get(n)||0;C.set(n,g+Number(o.amount))}),X=Array.from(C.entries()).map(([o,n])=>({day:o,revenue:n})).sort((o,n)=>parseInt(o.day)-parseInt(n.day)),H=r.reduce((o,n)=>o+Number(n.amount),0)}}}catch{}const we=P>0?j/P:0,Q=j-k,_e=Q,Ce=j>0?_e/j*100:0;let Z=0;const q=new Date,ee=q.getDate(),A=q.getMonth()+1,L=q.getFullYear();let R=A-1,J=L;R===0&&(R=12,J=L-1);try{const r=`transactions_${L}_${String(A).padStart(2,"0")}`,{data:_,error:C}=await b.from(r).select("transaction_date, amount").eq("user_id",l).eq("transaction_type","income").lte("transaction_date",`${L}-${String(A).padStart(2,"0")}-${String(ee).padStart(2,"0")}`),o=`transactions_${J}_${String(R).padStart(2,"0")}`,{data:n,error:g}=await b.from(o).select("transaction_date, amount").eq("user_id",l).eq("transaction_type","income").lte("transaction_date",`${J}-${String(R).padStart(2,"0")}-${String(ee).padStart(2,"0")}`);if(!C&&!g&&_&&n){const B=_.reduce((D,M)=>D+Number(M.amount),0),S=n.reduce((D,M)=>D+Number(M.amount),0);S>0&&(Z=(B-S)/S*100)}}catch{}xe({totalIncome:j,totalExpenses:d,balancePJ:ge,balanceCheckout:be,recentTransactions:je||[],monthlyRevenue:w,dailyRevenue:X,currentMonth:Ne,currentMonthRevenue:H,ticketMedio:we,lucroLiquido:Q,margemLucro:Ce,crescimentoMensal:Z,totalTransacoes:P}),pe(new Date)}catch{}finally{ue(!1)}},m=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t);return he?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-primary rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary-foreground"})}),e.jsx("h1",{className:"text-lg sm:text-2xl font-bold",children:"FinanceiroLogotiq"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground text-center",children:["Bem-vindo, ",i?.email]}),void 0,e.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded flex items-center space-x-2",children:[e.jsxs("span",{children:["DEBUG: dataSources.length = ",I.length," | selectedDataSource = ",l," | loadingDataSources = ",de?"true":"false"]}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>{alert("üî• BOT√ÉO TESTE CLICADO!"),V()},children:"Testar Load"})]}),I.length>=1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Je,{className:"h-4 w-4 text-gray-600"}),e.jsxs($e,{value:l,onValueChange:U,children:[e.jsx(Ie,{className:"w-48",children:e.jsx(ze,{placeholder:"Selecionar fonte de dados"})}),e.jsx(qe,{children:I.map(t=>e.jsx(Ae,{value:t.id,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:t.name}),t.isOwner&&t.id!==i.id&&e.jsx("span",{className:"text-xs text-blue-600",children:"(Compartilhado)"}),!t.isOwner&&e.jsx("span",{className:"text-xs text-green-600",children:"(Organiza√ß√£o)"})]})},t.id))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>N("/clients"),children:[e.jsx(Oe,{className:"w-4 h-4 mr-1"}),"CRM"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>N("/settings"),children:[e.jsx(Ue,{className:"w-4 h-4 mr-1"}),"Configura√ß√µes"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:z,children:"Atualizar"}),e.jsx(y,{variant:"outline",size:"sm",onClick:le,children:"Sair"})]})]})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["√öltima atualiza√ß√£o: ",fe.toLocaleTimeString("pt-BR")]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(a.totalIncome)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",m(a.totalIncome-a.totalExpenses)," vs despesas"]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Saldo em Caixa"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(a.balancePJ+a.balanceCheckout)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Soma das duas contas"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Saldo PJ"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(a.balancePJ)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conta Pessoa Jur√≠dica"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Saldo Checkout"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(a.balanceCheckout)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conta Checkout"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Ticket M√©dio"}),e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(a.ticketMedio)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Por venda (",a.totalTransacoes," vendas)"]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Lucro L√≠quido"}),e.jsx(et,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:`text-2xl font-bold ${a.lucroLiquido>=0?"text-green-600":"text-red-600"}`,children:m(a.lucroLiquido)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita - Despesas (sem prolabore)"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Margem de Lucro"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsxs("div",{className:`text-2xl font-bold ${a.margemLucro>=0?"text-green-600":"text-red-600"}`,children:[a.margemLucro.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Efici√™ncia financeira"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Crescimento Mensal"}),e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsxs("div",{className:`text-2xl font-bold flex items-center ${a.crescimentoMensal>=0?"text-green-600":"text-red-600"}`,children:[a.crescimentoMensal>=0?e.jsx(Ve,{className:"h-4 w-4 mr-1"}):e.jsx(Ke,{className:"h-4 w-4 mr-1"}),Math.abs(a.crescimentoMensal).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"acumulado at√© hoje vs m√™s anterior"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Evolu√ß√£o Mensal - Todas as Contas"}),e.jsx(F,{children:"Receita mensal total em 2025 (todas as contas)"})]}),e.jsx(f,{children:e.jsx(se,{width:"100%",height:300,children:e.jsxs(We,{data:a.monthlyRevenue,children:[e.jsx(ae,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"month"}),e.jsx(re,{}),e.jsx(oe,{formatter:t=>m(t),labelStyle:{color:"black"}}),e.jsx(Ge,{dataKey:"revenue",fill:"#3b82f6"})]})})})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:["Faturamento Di√°rio - ",a.currentMonth,e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"M√™s Atual"})]}),e.jsx(F,{children:a.currentMonth?`Receita di√°ria total em ${a.currentMonth.toLowerCase()} 2025 - Total: ${m(a.currentMonthRevenue)}`:"Carregando dados do m√™s atual..."})]}),e.jsx(f,{children:e.jsx(se,{width:"100%",height:300,children:e.jsxs(Xe,{data:a.dailyRevenue,children:[e.jsx(ae,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"day",label:{value:"Dia do M√™s",position:"insideBottom",offset:-5}}),e.jsx(re,{}),e.jsx(oe,{formatter:t=>[m(t),"Faturamento"],labelFormatter:t=>`Dia ${t}`,labelStyle:{color:"black"}}),e.jsx(He,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10b981",strokeWidth:2}})]})})})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Transa√ß√µes Recentes"}),e.jsxs(F,{children:["√öltimas ",a.recentTransactions.length," transa√ß√µes"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>N("/transactions"),children:"Ver Todas"}),e.jsxs(y,{size:"sm",onClick:()=>N("/transactions"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-4 w-4"}),"Nova Transa√ß√£o"]})]})]})}),e.jsx(f,{children:a.recentTransactions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Nenhuma transa√ß√£o encontrada"}),e.jsxs(y,{onClick:()=>N("/transactions"),className:"flex items-center gap-2 mx-auto",children:[e.jsx(ce,{className:"h-4 w-4"}),"Criar Primeira Transa√ß√£o"]})]}):e.jsx("div",{className:"space-y-4",children:a.recentTransactions.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-full ${t.transaction_type==="income"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:t.transaction_type==="income"?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.description}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(t.transaction_date).toLocaleDateString("pt-BR")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-medium ${t.transaction_type==="income"?"text-green-600":"text-red-600"}`,children:[t.transaction_type==="income"?"+":"-",m(t.amount)]}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:t.transaction_type})]})]},t.id))})})]})]})]})}export{yt as default};
