import{j as e}from"./ui-GI4EfHd4.js";import{r as n}from"./vendor-CZTyH7vC.js";import{u as T,a as L,s as l,d as a,X as R}from"./index-CBHLBQ1f.js";import{B as c,C as E,a as C,b as y,c as S,d as z}from"./card-C_z2SoH1.js";import{I as g}from"./input-kbtl2tZq.js";import{L as j}from"./label-Dc8omIqd.js";import{D as k,a as D,T as P,b as I,c as B,d as G,e as H}from"./dialog-fxPD5Uwu.js";import{A as M}from"./arrow-left-DtNsGxFP.js";import{S as O}from"./settings-Cef_lBYI.js";import{S as V}from"./shield-CWBJtLQn.js";import{U as A}from"./users-7-MId4HG.js";import{P as K}from"./plus-BPhMVBdZ.js";import{M as X}from"./mail-CguHER0k.js";import{C as J}from"./check-jC4ug3qQ.js";import"./supabase-DfbQpoin.js";import"./charts-DE-LwN1H.js";function xe(){const{user:r}=T(),m=L();n.useState(!1);const[u,_]=n.useState([]),[o,f]=n.useState(""),[p,d]=n.useState(!1);n.useEffect(()=>{if(!r){m("/auth");return}x()},[r,m]);const x=async()=>{if(r)try{const{data:s,error:i}=await l.from("organization_members").select("*").eq("owner_id",r.id).order("created_at",{ascending:!1});if(i){a.error(`Erro ao carregar usuários: ${i.message}`);return}_(s||[])}catch(s){a.error(`Erro inesperado ao carregar: ${s instanceof Error?s.message:"Erro desconhecido"}`)}},v=async()=>{if(!r||!o.trim()){a.error("Email é obrigatório");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.trim())){a.error("Formato de email inválido");return}d(!0);try{const{data:i,error:t}=await l.from("organization_members").select("email").eq("owner_id",r.id).eq("email",o.trim().toLowerCase()).single();if(i){a.error("Este email já foi adicionado à organização"),d(!1);return}if(t&&t.code!=="PGRST116"){a.error(`Erro ao verificar email: ${t.message}`),d(!1);return}const{data:N,error:$}=await l.from("profiles").select("id, email").eq("email",o.trim().toLowerCase()).single();let h="pending",w=null;N&&!$&&(h="active",w=N.id);const F={owner_id:r.id,member_id:w,email:o.trim().toLowerCase(),status:h},{data:Q,error:b}=await l.from("organization_members").insert(F).select().single();if(b){a.error(`Erro ao adicionar usuário: ${b.message}`);return}a.success(`Usuário ${h==="active"?"adicionado":"convidado"} com sucesso!`),f(""),x()}catch(i){a.error(`Erro inesperado: ${i instanceof Error?i.message:"Erro desconhecido"}`)}finally{d(!1)}},q=async(s,i)=>{if(r)try{const{error:t}=await l.from("organization_members").delete().eq("owner_id",r.id).eq("id",s);if(t){a.error("Erro ao remover usuário");return}a.success(`${i} removido da organização`),x()}catch{a.error("Erro ao remover usuário")}},U=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return r?e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>m("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Voltar"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Configurações"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie sua conta e organização"})]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(E,{children:[e.jsxs(C,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Informações da Conta"]}),e.jsx(S,{children:"Suas informações de usuário"})]}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",value:r.email||"",disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"user-id",children:"ID do Usuário"}),e.jsx(g,{id:"user-id",value:r.id,disabled:!0,className:"bg-muted text-xs"})]})]})})]}),e.jsxs(E,{children:[e.jsxs(C,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Compartilhamento de Dados"]}),e.jsx(S,{children:"Adicione usuários à sua organização para que eles visualizem os mesmos dados"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(j,{htmlFor:"new-user-email",children:"Email do usuário"}),e.jsx(g,{id:"new-user-email",type:"email",placeholder:"usuario@exemplo.com",value:o,onChange:s=>f(s.target.value),onKeyPress:s=>s.key==="Enter"&&v()})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(c,{onClick:v,disabled:p||!o.trim(),className:"flex items-center gap-2",children:p?"Adicionando...":e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),"Adicionar"]})})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Usuários com Acesso (",u.length,")"]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum usuário adicionado ainda"}),e.jsx("p",{className:"text-sm",children:"Adicione o email de um usuário acima"})]}):e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Adicionado em ",U(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:"Ativo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-600",children:"Pendente"})]})}),e.jsxs(k,{children:[e.jsx(D,{asChild:!0,children:e.jsx(c,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(P,{className:"h-4 w-4"})})}),e.jsxs(I,{children:[e.jsxs(B,{children:[e.jsx(G,{children:"Remover usuário"}),e.jsxs(H,{children:["Tem certeza que deseja remover ",e.jsx("strong",{children:s.email})," da sua organização? Esta ação não pode ser desfeita."]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(D,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"Cancelar"})}),e.jsx(c,{variant:"destructive",onClick:()=>q(s.id,s.email),children:"Remover"})]})]})]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Usuários adicionados terão acesso a todos os seus dados financeiros"}),e.jsx("li",{children:'• Se o usuário já tiver conta, o acesso será imediato (status "Ativo")'}),e.jsx("li",{children:'• Se não tiver conta, aparecerá como "Pendente" até criar uma conta'}),e.jsx("li",{children:"• Você pode remover o acesso a qualquer momento"})]})]})]})]})]})]}):null}export{xe as default};
