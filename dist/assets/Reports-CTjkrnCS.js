import{j as e}from"./ui-DjOJwOSE.js";import{r as y}from"./vendor-CZTyH7vC.js";import{u as O,a as P,k as $,s as Y,B as q,L as V,d as i,e as l,f as m,h as d,g as C}from"./index-s0ORY9Ml.js";import{S as A,a as H,b as K,c as U,d as D}from"./select-DlaVWtv0.js";import{F as z}from"./filter-qLaQz0IU.js";import{T as G}from"./trending-up-D0c6jvDY.js";import{T as J}from"./trending-down-ByxNJe-N.js";import{C as Q}from"./chart-column-BnhskrxQ.js";import{C as W}from"./calendar-APvNTBzw.js";import"./supabase-DfbQpoin.js";import"./charts-DE-LwN1H.js";import"./chevron-up-CVmdrHio.js";import"./check-DnaOswoR.js";function de(){const{user:p}=O(),b=P(),{toast:E}=$(),[n,B]=y.useState({monthlyIncome:[],monthlyExpenses:[],categoryBreakdown:[],clientStats:[],summary:{totalIncome:0,totalExpenses:0,balance:0,transactionCount:0}}),[I,T]=y.useState(!0),[v,R]=y.useState("6months");y.useEffect(()=>{if(!p){b("/auth");return}k()},[p,b,v]);const k=async()=>{if(p)try{T(!0);const s=new Date,o=new Date;switch(v){case"3months":o.setMonth(s.getMonth()-3);break;case"6months":o.setMonth(s.getMonth()-6);break;case"1year":o.setFullYear(s.getFullYear()-1);break;default:o.setMonth(s.getMonth()-6)}const{data:x}=await Y.from("transactions").select("*, clients(name)").eq("user_id",p.id).gte("transaction_date",o.toISOString().split("T")[0]).lte("transaction_date",s.toISOString().split("T")[0]).order("transaction_date",{ascending:!0});if(!x)return;const r={},u={},j={};let w=0,S=0;x.forEach(t=>{const a=new Date(t.transaction_date),f=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,h=Number(t.amount);r[f]||(r[f]={income:0,expenses:0}),t.transaction_type==="income"?(r[f].income+=h,w+=h):t.transaction_type==="expense"&&(r[f].expenses+=h,S+=h);const N=t.category||"Sem categoria";u[N]||(u[N]={amount:0,count:0}),u[N].amount+=h,u[N].count+=1;const g=t.clients?.name||"Sem cliente";j[g]||(j[g]={total:0,transactions:0}),j[g].total+=h,j[g].transactions+=1});const M=Object.entries(r).map(([t,a])=>({month:new Date(t+"-01").toLocaleDateString("pt-BR",{month:"short",year:"numeric"}),amount:a.income})),F=Object.entries(r).map(([t,a])=>({month:new Date(t+"-01").toLocaleDateString("pt-BR",{month:"short",year:"numeric"}),amount:a.expenses})),L=Object.entries(u).map(([t,a])=>({category:t,amount:a.amount,count:a.count})).sort((t,a)=>a.amount-t.amount).slice(0,10),_=Object.entries(j).map(([t,a])=>({name:t,total:a.total,transactions:a.transactions})).sort((t,a)=>a.total-t.total).slice(0,10);B({monthlyIncome:M,monthlyExpenses:F,categoryBreakdown:L,clientStats:_,summary:{totalIncome:w,totalExpenses:S,balance:w-S,transactionCount:x.length}})}catch{E({title:"Erro",description:"Erro ao carregar dados do relatório",variant:"destructive"})}finally{T(!1)}},c=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s);return I?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{variant:"ghost",onClick:()=>b("/dashboard"),children:"← Dashboard"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Relatórios"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx(V,{htmlFor:"period",children:"Período:"}),e.jsxs(A,{value:v,onValueChange:R,children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{})}),e.jsxs(U,{children:[e.jsx(D,{value:"3months",children:"3 meses"}),e.jsx(D,{value:"6months",children:"6 meses"}),e.jsx(D,{value:"1year",children:"1 ano"})]})]})]})})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(i,{className:"shadow-finance-sm",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total de Receitas"}),e.jsx(G,{className:"h-4 w-4 text-success"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-success",children:c(n.summary.totalIncome)})})]}),e.jsxs(i,{className:"shadow-finance-sm",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total de Despesas"}),e.jsx(J,{className:"h-4 w-4 text-destructive"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:c(n.summary.totalExpenses)})})]}),e.jsxs(i,{className:"shadow-finance-sm",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Saldo Líquido"}),e.jsx(Q,{className:"h-4 w-4 text-primary"})]}),e.jsx(d,{children:e.jsx("div",{className:`text-2xl font-bold ${n.summary.balance>=0?"text-success":"text-destructive"}`,children:c(n.summary.balance)})})]}),e.jsxs(i,{className:"shadow-finance-sm",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Transações"}),e.jsx(W,{className:"h-4 w-4 text-info"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-info",children:n.summary.transactionCount})})]})]}),e.jsxs(i,{className:"shadow-finance-md",children:[e.jsxs(l,{children:[e.jsx(m,{children:"Tendência Mensal"}),e.jsx(C,{children:"Evolução de receitas e despesas por mês"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:n.monthlyIncome.map((s,o)=>{const x=n.monthlyExpenses[o],r=s.amount-(x?.amount||0);return e.jsxs("div",{className:"grid grid-cols-4 gap-4 items-center p-4 rounded-lg border",children:[e.jsx("div",{className:"font-medium",children:s.month}),e.jsx("div",{className:"text-success font-semibold",children:c(s.amount)}),e.jsx("div",{className:"text-destructive font-semibold",children:c(x?.amount||0)}),e.jsx("div",{className:`font-semibold ${r>=0?"text-success":"text-destructive"}`,children:c(r)})]},s.month)})})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(i,{className:"shadow-finance-md",children:[e.jsxs(l,{children:[e.jsx(m,{children:"Por Categoria"}),e.jsx(C,{children:"Top 10 categorias por valor"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:n.categoryBreakdown.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.category}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.count," transações"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold",children:c(s.amount)})})]},s.category))})})]}),e.jsxs(i,{className:"shadow-finance-md",children:[e.jsxs(l,{children:[e.jsx(m,{children:"Por Cliente"}),e.jsx(C,{children:"Top 10 clientes por volume"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:n.clientStats.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.transactions," transações"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold",children:c(s.total)})})]},s.name))})})]})]})]})]})}export{de as default};
