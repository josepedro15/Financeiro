import{j as e}from"./ui-Cnk5WNzt.js";import{r as w}from"./vendor-CZTyH7vC.js";import{c as D,u as ke,a as Me,s as _}from"./index-DMPpfWZc.js";import{C as m,a as d,b as x,d as h,c as $}from"./card-CNKSsfyp.js";import{B as g}from"./button-BiYs1Tae.js";import{D as q}from"./dollar-sign-CW35_ZFW.js";import{U as Te}from"./users-DS2V_Jg4.js";import{C as De,T as Pe}from"./trending-up-C59xJYLf.js";import{T as Se}from"./trending-down-2Qd5qo3Y.js";import{R as H,B as Ee,C as Q,X as Z,Y as ee,T as te,a as Re,L as Je,b as Le}from"./charts-DE-LwN1H.js";import{P as se}from"./plus-BcjBAqMl.js";import{A as $e,a as qe}from"./arrow-up-right-Cdiw-2zv.js";import"./supabase-DfbQpoin.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=D("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=D("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=D("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=D("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2V5z",key:"1ivx2i"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h.01",key:"xkw8gn"}]]);function at(){const{user:i,signOut:ne}=ke(),j=Me(),[s,re]=w.useState({totalIncome:0,totalExpenses:0,balancePJ:0,balanceCheckout:0,recentTransactions:[],monthlyRevenue:[],dailyRevenue:[],currentMonth:"",currentMonthRevenue:0,ticketMedio:0,lucroLiquido:0,margemLucro:0,crescimentoMensal:0,totalTransacoes:0}),[oe,ce]=w.useState(!0),[ie,le]=w.useState(new Date);w.useEffect(()=>{if(!i){j("/auth");return}P()},[i,j]),w.useEffect(()=>{if(!i)return;const a=setInterval(()=>{P()},3e4);return()=>clearInterval(a)},[i]);const P=async()=>{if(i)try{const a=[{table:"transactions_2025_01",month:"Jan",monthNum:1},{table:"transactions_2025_02",month:"Fev",monthNum:2},{table:"transactions_2025_03",month:"Mar",monthNum:3},{table:"transactions_2025_04",month:"Abr",monthNum:4},{table:"transactions_2025_05",month:"Mai",monthNum:5},{table:"transactions_2025_06",month:"Jun",monthNum:6},{table:"transactions_2025_07",month:"Jul",monthNum:7},{table:"transactions_2025_08",month:"Ago",monthNum:8},{table:"transactions_2025_09",month:"Set",monthNum:9},{table:"transactions_2025_10",month:"Out",monthNum:10},{table:"transactions_2025_11",month:"Nov",monthNum:11},{table:"transactions_2025_12",month:"Dez",monthNum:12}];let S=[],I=[],C=[],y=0,F=0,z=0,A=0,B=0,k=0;for(const r of a)try{const{data:f,error:p}=await _.from(r.table).select("*").eq("user_id",i.id);if(p){C.push({month:r.month,revenue:0});continue}const o=f||[],n=o.filter(t=>t.transaction_type==="income"),u=o.filter(t=>t.transaction_type==="expense"),L=u.filter(t=>t.category!=="Prolabore"),N=n.filter(t=>t.account_name==="Conta PJ"),b=n.filter(t=>t.account_name==="Conta Checkout"),v=u.filter(t=>t.account_name==="Conta PJ"),ge=u.filter(t=>t.account_name==="Conta Checkout"),Ne=n.reduce((t,c)=>t+Number(c.amount),0),be=u.reduce((t,c)=>t+Number(c.amount),0),ve=L.reduce((t,c)=>t+Number(c.amount),0),X=N.reduce((t,c)=>t+Number(c.amount),0),we=b.reduce((t,c)=>t+Number(c.amount),0),_e=v.reduce((t,c)=>t+Number(c.amount),0),Ce=ge.reduce((t,c)=>t+Number(c.amount),0);y+=Ne,F+=be,z+=ve,k+=n.length,A+=X-_e,B+=we-Ce,S=[...S,...o],I=[...I,...n],C.push({month:r.month,revenue:X})}catch{C.push({month:r.month,revenue:0})}const{data:me,error:Ae}=await _.from("transactions").select("*").eq("user_id",i.id).order("created_at",{ascending:!1}).limit(5),Be=S.filter(r=>r.transaction_date?.startsWith("2025-04")),de=A,xe=B,Y=new Date,U=Y.getMonth()+1,he=Y.getFullYear(),ue=a.find(r=>r.monthNum===U)?.month||"",fe=`transactions_${he}_${String(U).padStart(2,"0")}`;let K=[],W=0;try{const{data:r,error:f}=await _.from(fe).select("transaction_date, amount, account_name").eq("user_id",i.id).eq("transaction_type","income").eq("account_name","Conta PJ");if(!f){if(r){const p=new Map;r.forEach(o=>{const n=new Date(o.transaction_date).getDate().toString(),u=p.get(n)||0;p.set(n,u+Number(o.amount))}),K=Array.from(p.entries()).map(([o,n])=>({day:o,revenue:n})).sort((o,n)=>parseInt(o.day)-parseInt(n.day)),W=r.reduce((o,n)=>o+Number(n.amount),0)}}}catch{}const pe=k>0?y/k:0,O=y-z,je=O,ye=y>0?je/y*100:0;let V=0;const E=new Date,G=E.getDate(),R=E.getMonth()+1,M=E.getFullYear();let T=R-1,J=M;T===0&&(T=12,J=M-1);try{const r=`transactions_${M}_${String(R).padStart(2,"0")}`,{data:f,error:p}=await _.from(r).select("transaction_date, amount").eq("user_id",i.id).eq("transaction_type","income").eq("account_name","Conta PJ").lte("transaction_date",`${M}-${String(R).padStart(2,"0")}-${String(G).padStart(2,"0")}`),o=`transactions_${J}_${String(T).padStart(2,"0")}`,{data:n,error:u}=await _.from(o).select("transaction_date, amount").eq("user_id",i.id).eq("transaction_type","income").eq("account_name","Conta PJ").lte("transaction_date",`${J}-${String(T).padStart(2,"0")}-${String(G).padStart(2,"0")}`);if(!p&&!u&&f&&n){const L=f.reduce((b,v)=>b+Number(v.amount),0),N=n.reduce((b,v)=>b+Number(v.amount),0);N>0&&(V=(L-N)/N*100)}}catch{}re({totalIncome:y,totalExpenses:F,balancePJ:de,balanceCheckout:xe,recentTransactions:me||[],monthlyRevenue:C,dailyRevenue:K,currentMonth:ue,currentMonthRevenue:W,ticketMedio:pe,lucroLiquido:O,margemLucro:ye,crescimentoMensal:V,totalTransacoes:k}),le(new Date)}catch{}finally{ce(!1)}},l=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return oe?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-primary rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary-foreground"})}),e.jsx("h1",{className:"text-lg sm:text-2xl font-bold",children:"FinanceiroLogotiq"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground text-center",children:["Bem-vindo, ",i?.email]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>j("/clients"),children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"CRM"]}),e.jsx(g,{variant:"outline",size:"sm",onClick:P,children:"Atualizar"}),e.jsx(g,{variant:"outline",size:"sm",onClick:ne,children:"Sair"})]})]})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Última atualização: ",ie.toLocaleTimeString("pt-BR")]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l(s.totalIncome)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",l(s.totalIncome-s.totalExpenses)," vs despesas"]})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Saldo em Caixa"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l(s.balancePJ+s.balanceCheckout)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Soma das duas contas"})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Saldo PJ"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l(s.balancePJ)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conta Pessoa Jurídica"})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Saldo Checkout"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l(s.balanceCheckout)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conta Checkout"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Ticket Médio"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l(s.ticketMedio)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Por venda (",s.totalTransacoes," vendas)"]})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Lucro Líquido"}),e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:`text-2xl font-bold ${s.lucroLiquido>=0?"text-green-600":"text-red-600"}`,children:l(s.lucroLiquido)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita - Despesas (sem prolabore)"})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Margem de Lucro"}),e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:`text-2xl font-bold ${s.margemLucro>=0?"text-green-600":"text-red-600"}`,children:[s.margemLucro.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Eficiência financeira"})]})]}),e.jsxs(m,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Crescimento Mensal"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:`text-2xl font-bold flex items-center ${s.crescimentoMensal>=0?"text-green-600":"text-red-600"}`,children:[s.crescimentoMensal>=0?e.jsx(Pe,{className:"h-4 w-4 mr-1"}):e.jsx(Se,{className:"h-4 w-4 mr-1"}),Math.abs(s.crescimentoMensal).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"acumulado até hoje vs mês anterior"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"Evolução Mensal - Conta PJ"}),e.jsx($,{children:"Receita mensal da Conta PJ em 2025"})]}),e.jsx(h,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(Ee,{data:s.monthlyRevenue,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"month"}),e.jsx(ee,{}),e.jsx(te,{formatter:a=>l(a),labelStyle:{color:"black"}}),e.jsx(Re,{dataKey:"revenue",fill:"#3b82f6"})]})})})]}),e.jsxs(m,{children:[e.jsxs(d,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:["Faturamento Diário Conta PJ - ",s.currentMonth,e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"Mês Atual"})]}),e.jsx($,{children:s.currentMonth?`Receita diária da Conta PJ em ${s.currentMonth.toLowerCase()} 2025 - Total: ${l(s.currentMonthRevenue)}`:"Carregando dados do mês atual..."})]}),e.jsx(h,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(Je,{data:s.dailyRevenue,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"day",label:{value:"Dia do Mês",position:"insideBottom",offset:-5}}),e.jsx(ee,{}),e.jsx(te,{formatter:a=>[l(a),"Faturamento"],labelFormatter:a=>`Dia ${a}`,labelStyle:{color:"black"}}),e.jsx(Le,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10b981",strokeWidth:2}})]})})})]})]}),e.jsxs(m,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Transações Recentes"}),e.jsxs($,{children:["Últimas ",s.recentTransactions.length," transações"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>j("/transactions"),children:"Ver Todas"}),e.jsxs(g,{size:"sm",onClick:()=>j("/transactions"),className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),"Nova Transação"]})]})]})}),e.jsx(h,{children:s.recentTransactions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Nenhuma transação encontrada"}),e.jsxs(g,{onClick:()=>j("/transactions"),className:"flex items-center gap-2 mx-auto",children:[e.jsx(se,{className:"h-4 w-4"}),"Criar Primeira Transação"]})]}):e.jsx("div",{className:"space-y-4",children:s.recentTransactions.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-full ${a.transaction_type==="income"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:a.transaction_type==="income"?e.jsx($e,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.description}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(a.transaction_date).toLocaleDateString("pt-BR")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-medium ${a.transaction_type==="income"?"text-green-600":"text-red-600"}`,children:[a.transaction_type==="income"?"+":"-",l(a.amount)]}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:a.transaction_type})]})]},a.id))})})]})]})]})}export{at as default};
